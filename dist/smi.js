"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol?"symbol":typeof t},Smi=function(){var t={renderNum:0,data:{}};t.getIns=function(e){return e instanceof Array?e.map(function(e){return t.data[e]}):t.data[e]},t.getHigherIDs=function(t){var e=t,n=[];for(n.push(e);e=e.slice(0,-2);)n.push(e);return n},t.setIns=function(e,n){t.data[e]=n};var e={};e.__attr__=["class","data","style","id","src","name","value","href"],e.each=function(t){this.__attr__.forEach(function(e){t(e)})},e.testRegExp=new RegExp("_([a-z]+)_$");var n={};n.deepCopy=function(t,e){return Object.keys(e).forEach(function(n){if(void 0!==e[n]){if(null===e[n])return void(t[n]=null);if(Object.getPrototypeOf(e[n])===Object.prototype)"_style_"===n&&t[n]&&Object.getPrototypeOf(t[n])===Object.prototype||(t[n]={}),this.deepCopy(t[n],e[n]);else try{t[n]=e[n]}catch(i){t={},t[n]=e[n],console.warn("the object copyTo may not be a object")}}}.bind(this)),t},n.Content=function(t,e){this.value=e,this.initInfo=void 0!==t?t:"computed"},n.diff=function(t,e){var n,i;return void 0===t&&(t=e instanceof Array?[]:Object.getPrototypeOf(e)===Object.prototype?{}:" "),t instanceof Array&&e instanceof Array?(n=[],i=[],t.forEach(function(t){e.some(function(e){return t==e})||i.push(t)}),e.forEach(function(e){t.some(function(t){return e==t})||n.push(e)}),0===n.length&&0===i.length?!0:{"+":n,"-":i}):Object.getPrototypeOf(t)===Object.prototype&&Object.getPrototypeOf(e)===Object.prototype?(n={},i=[],Object.keys(t).forEach(function(o){if(void 0===e[o])i.push(o);else{if(e[o]===t[o])return;n[o]=e[o]}}),Object.keys(e).forEach(function(i){if(void 0===t[i])n[i]=e[i];else if(e[i]===t[i])return}),0===Object.keys(n).length&&0===i.length?!0:{"+":n,"-":i}):"string"==typeof t&&"string"==typeof e?t===e?!0:{"+":e}:!1},n.deepDiff=function(t,e){for(var i in t){if(void 0===e[i])return!1;if(null===t[i]){if(null===e[i])continue;return!1}if("object"===_typeof(t[i])&&"object"===_typeof(e[i])){if(Object.getPrototypeOf(t[i])!==Object.getPrototypeOf(e[i]))return!1;if(n.deepDiff(t[i],e[i])===!1)return!1}else if(t[i]!==e[i])return!1}for(i in e)if(void 0===t[i])return!1;return!0},n.update=function(i){(function o(){if(e.each(function(t){var e,i,o=this;if(void 0!==(e=this.prop["_"+t+"_"])&&(i=n.diff(this.__currentState__[t],e),i!==!0)){var r={};if(r[t]=i,this.__opNum__.push(r),i["+"]instanceof Array)this.__currentState__[t]=e.slice();else if("string"==typeof i["+"])this.__currentState__[t]=e;else{var a=Object.keys(i["+"]),s=i["-"];a.forEach(function(n){o.__currentState__[t][n]=e[n]}),s.forEach(function(e){delete o.__currentState__[t][e]})}}}.bind(this)),0!==this.__opNum__.length&&(this.__opNum__.forEach(function(t){var e=Object.keys(t)[0];this.__op__(e,"+")(t[e]["+"]),this.__op__(e,"-")(t[e]["-"])}.bind(this)),this.__opNum__=[]),!this.__isSpecial__){var i=this.content(),r=t.getIns(this.__currentState__.content);if(i instanceof Array)i.forEach(function(t,e){if(t instanceof a&&t.__compT==r[e].initInfo.__compT){if(n.deepDiff(t.__dataAdd,r[e].initInfo.__dataAdd)===!0)return;r[e].value.setPropData(t.__dataAdd),r[e].initInfo.__dataAdd=t.__dataAdd,o.call(r[e].value)}else r[e].initInfo!=t&&(r[e].initInfo=t,r[e].value.nodeValue=t)});else if(i instanceof a){if(n.deepDiff(i.__dataAdd,r[0].initInfo.__dataAdd)===!0)return;r[0].value.setPropData(i.__dataAdd),r[0].initInfo.__dataAdd=i.__dataAdd,o.call(r[0].value)}else r[0].initInfo!=i&&(r[0].initInfo=i,r[0].value.nodeValue=i)}}).call(i)};var i=function(t){this.nativeEvent=t,this.bubbles=!0,this.immdeiateBubbles=!0,this.cancelable=t.cancelable,this.defaultPrevented=!1,this.preventDefault=t.preventDefault.bind(t),this.type=t.type,this.isTrusted=t.isTrusted,this.target=t.target,this.timeStamp=t.timeStamp,this.currentTarget=null,this.init()};i.Type={Clipboard:["clipboardData"],Composition:["data"],Keyboard:["altKey","charCode","ctrlKey","key","keyCode","locale","location","metaKey","repeat","shiftKey","which"],Focus:["relatedTarget"],UI:["detail","view"],Wheel:["deltaMode","deltaX","deltaY","deltaZ"],Touch:["altKey","changedTouches","ctrlKey","metaKey","shiftKey","targetTouches","touches"],Mouse:["altKey","button","buttons","clientX","clientY","ctrlKey","metaKey","pageX","pageY","relatedTarget","screenX","screenY","shiftKey","offsetX","offsetY","getModifierState"],Form:[]},i.Event={copy:"Clipboard",cut:"Clipboard",paste:"Clipboard",compositionend:"Composition",compositionstart:"Composition",compositionupdate:"Composition",keydown:"Keyboard",keypress:"Keyboard",keyup:"Keyboard",focus:"Focus",blur:"Focus",scroll:"UI",wheel:"Wheel",mousedown:"Mouse",mouseup:"Mouse",mousemove:"Mouse",click:"Mouse",dblclick:"Mouse",mouseover:"Mouse",mouseout:"Mouse",mouseenter:"Mouse",mouseleave:"Mouse",contextmenu:"Mouse",touchstart:"Touch",touchend:"Touch",touchmove:"Touch",touchcancel:"Touch",change:"Form",submit:"Form",input:"Form",select:"Form"},i.prototype.init=function(){var t=this;i.Type[i.Event[this.type]].forEach(function(e){t[e]=t.nativeEvent[e]})},i.prototype.stopPropagation=function(){this.bubbles=!1,this.nativeEvent.stopPropagation()},i.prototype.preventDefault=function(){this.defaultPrevented=!0,this.nativeEvent.preventDefault()},i.prototype.stopImmediatePropagation=function(){this.immdeiateBubbles=!1,this.bubbles=!1,this.nativeEvent.stopImmediatePropagation()};var o=function(){this.rawEvents={},this.compEvents={}};o.instanceList=[],o.CompEvent=["init"],o.prototype.hasAdd=function(t){return this.rawEvents.hasOwnProperty(t)},o.prototype.evtFunc=function(e){var n=this;return function(o){var r=Object.keys(n.rawEvents[e]).length-1;if(0!==r)for(var a,s=o.target.dataset.smiid,_=t.getHigherIDs(s),c=new i(o),u=0,h=0;h<_.length;h++)if(a=_[h],n.rawEvents[e].hasOwnProperty(a)){if(c.currentTarget=t.getIns(a).value,n.rawEvents[e][a]instanceof Array){for(var f in n.rawEvents[e][a])if(n.rawEvents[e][a][f](c),!c.immdeiateBubbles)return}else n.rawEvents[e][a](c);if(!c.bubbles)return;if(u++,u===r)return}}},o.prototype.push=function(e){var n=this,i=t.getIns(e).value;for(var r in i.__eventHandle__)this.hasAdd(r)||(this.rawEvents[r]={}),this.rawEvents[r][e]=i.__eventHandle__[r];o.CompEvent.forEach(function(t){i.fns.hasOwnProperty(t)&&(n.compEvents.hasOwnProperty(t)||(n.compEvents[t]={}),n.compEvents[t][e]=i.fns[t].bind(i))})},o.prototype.on=function(t,e,n){if(!this.hasAdd(t))return this.rawEvents[t]={},this.rawEvents[t][n]=e,this.rawEvents[t].handleFunc=this.evtFunc(t),void this.root.addEventListener(t,this.rawEvents[t].handleFunc,!1);if(void 0!==this.rawEvents[t][n]){var i=[];i.push(this.rawEvents[t][n]),i.push(e),this.rawEvents[t][n]=i}else this.rawEvents[t][n]=e},o.prototype.off=function(t,e){try{delete this.rawEvents[t][e],1===Object.keys(this.rawEvents[t]).length&&(this.root.removeEventListener(t,this.rawEvents[t].handleFunc),delete this.rawEvents[t])}catch(n){console.warn("smiid-"+e+" : the "+t+" event has not been attached")}},o.prototype.hasOn=function(t,e){try{return this.rawEvents[t].hasOwnProperty(e)?!0:!1}catch(n){return!1}},o.prototype.remove=function(t,e){this.rawEvents[e][t]&&delete this.rawEvents[e][t]},o.prototype.start=function(e){this.push(e),this.root=t.getIns(e).value.__raw__;var n;for(n in this.rawEvents)this.rawEvents[n].handleFunc=this.evtFunc(n),this.root.addEventListener(n,this.rawEvents[n].handleFunc,!1);o.instanceList.push(this);for(n in this.compEvents.init)this.compEvents.init[n]()};var r=function(t,e,n){t.prop=t.prop||{},this.__prop__=t.prop,this.fnsCopy(t.fns),this.content=t.content||function(){},this.setPropData(e),this.prop._raw_=this.prop._raw_||"div",this.__isSpecial__=!1,this.__raw__=document.createElement(this.prop._raw_),this.__eventHandle__=n,this.__currentState__={},this.__opNum__=[]};r.prototype.fnsCopy=function(t){if(this.fns={},void 0!==t)for(var e in t)this.fns[e]=t[e].bind(this)},r.prototype.__op__=function(t,e){function n(t,n){switch(e){case"+":return function(e){void 0!==e&&t.call(i,e)};case"-":return function(t){void 0!==t&&n.call(i,t)}}}var i=this;switch(t){case"class":return n(function(t){t instanceof Array?t.forEach(function(t){this.__raw__.classList.add(t)}.bind(this)):this.__raw__.classList.add(t)},function(t){t instanceof Array?t.forEach(function(t){this.__raw__.classList.remove(t)}.bind(this)):this.__raw__.classList.remove(t)});case"data":return n(function(t){Object.keys(t).forEach(function(e){this.__raw__.dataset[e]=t[e]}.bind(this))},function(t){t instanceof Array?t.forEach(function(t){this.__raw__.dataset[t]="",delete this.__raw__.dataset[t]}.bind(this)):(this.__raw__.dataset[item]="",delete this.__raw__.dataset[t])});case"style":return n(function(t){Object.keys(t).forEach(function(e){this.__raw__.style[e]=t[e]}.bind(this))},function(t){t instanceof Array?t.forEach(function(t){this.__raw__.style[t]=""}.bind(this)):this.__raw__.style[t]=""});default:return n(function(e){this.__raw__[t]=e},function(e){this.__raw__[t]=""})}},r.prototype.update=function(){n.update(this)},r.prototype.setPropData=function(t){this.prop=n.deepCopy(n.deepCopy({},this.__prop__),t)},r.prototype.off=function(t){o.instanceList[this.__id__[0]].off(t,this.__id__)},r.prototype.on=function(t,e){o.instanceList[this.__id__[0]].on(t,e,this.__id__)},r.prototype.hasOn=function(t){return o.instanceList[this.__id__[0]].hasOn(t,this.__id__)},r.prototype.share=function(t,e){r.ShareParaList.hasOwnProperty(t)&&r.ShareParaList[t].sharer_id!==this.__id__&&console.warn("some shared parameter has been covered"),r.ShareParaList[t]={sharer_id:this.__id__,value:void 0===e?null:e}},r.prototype.getShared=function(t){return r.ShareParaList.hasOwnProperty(t)?new RegExp("^"+r.ShareParaList[t].sharer_id).test(this.__id__)?r.ShareParaList[t].value:(console.warn("have no access to get the value"),null):(console.warn("the shared value does't exit"),null)},r.ShareParaList={};var a=function(t,e,n){this.__compT=t,this.__dataAdd=e,this.__eventHandle=n},s=function(t){return function(e,n){return e=e||{},n=n||{},new a(t,e,n)}},_=function(i,s){var _=function f(i,o){var s=function(e){var i=o+"."+_++;if(e instanceof a){var r=f(e,i);u.__currentState__.content.push(i),c.push(i),u.__raw__.appendChild(r.__raw__)}else try{var s=document.createTextNode(e);t.setIns(i,new n.Content(e,s)),u.__currentState__.content.push(i),u.__raw__.appendChild(s)}catch(h){console.warn(h)}},_=0,u=new r(i.__compT,i.__dataAdd,i.__eventHandle);t.setIns(o,new n.Content(i,u)),u.__id__=o,u.__op__("data","+")({smiid:o}),Object.keys(u.prop).forEach(function(t){var i=e.testRegExp.exec(t);if(null!==i){switch(i[1]){case"style":case"data":u.__currentState__[i[1]]={},n.deepCopy(u.__currentState__[i[1]],u.prop[t]);break;case"class":u.__currentState__[i[1]]=u.prop[t].slice();break;default:u.__currentState__[i[1]]=u.prop[t]}u.__op__(i[1],"+")(u.prop[t])}});var h=u.content();return h===!1?u.__isSpecial__=!0:(u.__currentState__.content=[],void 0===h?(console.warn("lack of any required parameter"),h="undefined"):null===h&&(h="null"),h instanceof Array?h.forEach(function(t){void 0===t?(console.warn("lack of any required parameter"),t="undefined"):null===h&&(t="null"),s(t)}):s(h)),u},c=new o,u=t.renderNum++,h=_(i,u+"");c.start(u),s.appendChild(h.__raw__)};return{deF:s,render:_}}();
//# sourceMappingURL=smi.js.map
